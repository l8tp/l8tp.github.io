<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" rev="stylesheet" href="css/style.css" type="text/css" />

		<title>搜索</title>
		<style>
			body {
				background: #f8f0e1;
				padding: 0px;
				margin: 0px;
			}

			#searchInput {}

			#head2 {}
			#Results{display: flex;}
		</style>
	</head>
	<body>
		<div class="anniu">
			<button class="button" onclick="appendToInput('酸')" style="background-image: url(images/酸.jpg)">酸</button>
			<button class="button" onclick="appendToInput('甜')" style="background-image: url(images/甜.jpg)">甜</button>
			<button class="button" onclick="appendToInput('辣')" style="background-image: url(images/辣.jpg)">辣</button>
			<button class="button" onclick="appendToInput('咸')" style="background-image: url(images/咸.jpg)">咸</button>
			<button class="button" onclick="appendToInput('香')" style="background-image: url(images/香.jpg)">香</button>
			<button class="button" onclick="appendToInput('酥')" style="background-image: url(images/香.jpg)">酥</button>
			<button class="button" onclick="appendToInput('软')" style="background-image: url(images/甜.jpg)">软</button>
		</div>
		<!-- 搜索框 -->
		<form style="display: flex; flex-direction: column; justify-content:center;">
			<a class="leiBie">菜名、别名</a><input type="text" id="searchInput" class="searchys" placeholder="输入搜索词"><br>
			<a class="leiBie">难度、口味</a><input type="text" id="searchKwei" class="searchys" placeholder="输入搜索词">
		</form>
		<!-- 搜索结果 -->
		<div id = Results>
			<button id="btn" class="button2">^收起^</button>
			<ul class="searchResults" id="sResults">
				<!-- 搜索结果将会动态加载到这里 -->
			</ul>
		</div>

		<!-- JavaScript 代码 -->
<!-- 		<script src="css/search.js"></script> -->
		<script>
			function appendToInput(taste) {
				document.getElementById("searchKwei").value = taste;
				sousuo();
			}
			document.getElementById('searchInput').onchange = function(){sousuo()}//按下回车或失去焦点执行函数
			document.getElementById('searchKwei').onchange = function(){sousuo()}//按下回车或失去焦点执行函数
			
			function sousuo () {  //搜索函数，开始搜索准备
				const SRContainer = document.getElementById('sResults');//const声明常量，但其内部属性和元素可以改变
				const RContainer = document.getElementById('Results');//const声明常量，但其内部属性和元素可以改变
				var sKname = document.getElementById('searchInput').value.toLowerCase();  //输入字符串大写字母转化成小写
				var sKwei = document.getElementById('searchKwei').value.toLowerCase();  //输入字符串大写字母转化成小写
				console.log(sKname + " " + sKwei)
				console.log(RContainer)
				var btn = document.getElementById('btn')
				btn.onclick = function () {RContainer.style.display="none"}
				loadData('menu.json')//调用异步函数加载json数据并匹配
				// 异步加载函数
				async function loadData(datalink) {
					// 1. 使用 Fetch API 获取数据
					const response = await fetch(datalink);
					// 2. 解析 JSON
					const data = await response.json();
//					console.log(data.menu);
					// 3.对比数据并刷新显示
					var number = 1;
					var hasResults = false;
					SRContainer.innerHTML =""
					// var head2 = document.createElement("button");
					// head2.id = "head2";
					// head2.className = 'aurl';
					// head2.textContent = "^收起^";
					// head2.style = "font-size:20px; background:rgba(0, 255, 170, 0.2); color:rgb(0, 170, 0)";
					// head2.onclick = function(){
					// 	console.log("点击了");
					// 	SRContainer.style.display = 'none';}//设置一个收起按钮
					// SRContainer.appendChild(head2);
					for(var i in data.menu){
		//				console.log(i)
						if((i.includes(sKname)||data.menu[i].nameb.includes(sKname))&&data.menu[i].kowei.includes(sKwei)){
							console.log(`${i}包含“${sKname}” 而且 ${data.menu[i].kowei}包含“${sKwei}”`)
							SRContainer.innerHTML += `<li><a href="calo.html?name=${i}" class='aurl'>${number}.${i}</a></li>`
							number++;
							hasResults = true;
						}
					};
					if(hasResults){
						RContainer.style.display = 'block'
					}else{
						RContainer.style.display = 'block'
						SRContainer.innerHTML += `<li><a style="color: #ff0000;">没搜到</a></li>`
					};
				};
			};			
			
		</script>
	</body>
</html>